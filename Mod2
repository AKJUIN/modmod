import streamlit as st
import pandas as pd
from docx import Document
import os

def extract_moderation_data(file):
    doc = Document(file)
    content = "\n".join([p.text for p in doc.paragraphs if p.text.strip()])
    module_code = extract_field(content, "Module code and name")
    module_name = extract_field(content, "Module coordinator name")
    problem_identified = "Y" if "Problem identified?" in content and "yes" in content.lower() else "N"
    problem_details = extract_field(content, "Details on problems identified during assessment moderation")
    actions_taken = extract_field(content, "Action taken")
    return {
        "Module Code": module_code,
        "Module Name": module_name,
        "Problem Identified": problem_identified,
        "Problem Details": problem_details,
        "Actions Taken": actions_taken
    }

def extract_field(content, field_name):
    start = content.lower().find(field_name.lower())
    if start == -1:
        return None
    start += len(field_name)
    end = content[start:].find("\n")
    return content[start:start+end].strip() if end != -1 else content[start:].strip()

st.title("Moderation Data Extraction Tool")
uploaded_files = st.file_uploader("Upload Word Documents", accept_multiple_files=True, type=["docx"])

if st.button("Process Files"):
    if uploaded_files:
        data = [extract_moderation_data(file) for file in uploaded_files]
        df = pd.DataFrame(data)
        st.write(df)
        st.download_button("Download Data as Excel", df.to_excel(index=False), "Moderation_Data.xlsx")
